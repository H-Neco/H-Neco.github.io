<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>profile | Blog</title>
  <meta name="description" content="">

  
  
    <meta property="og:image" content="https://h-neco.github.io/img/profile.png" />
    <meta property="og:title" content="profile | Blog" />   
  
  <meta property="og:description" content="" />
  <meta name="author" content="h neco">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900&display=swap"></noscript>
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
      <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap"></noscript>
  <link rel="preload" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css"></noscript>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/devicons/1.8.0/css/devicons.min.css" integrity="sha512-JW3fT0YTK7pT7w437SoX6GcW76jOZ6E0jGmrqBAcloC4GKT+njHOY4fX5KxJ9WfIXTkNrAF994525fAHp+KCxg==" crossorigin="anonymous" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/devicons/1.8.0/css/devicons.min.css" integrity="sha512-JW3fT0YTK7pT7w437SoX6GcW76jOZ6E0jGmrqBAcloC4GKT+njHOY4fX5KxJ9WfIXTkNrAF994525fAHp+KCxg==" crossorigin="anonymous"></noscript>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css" integrity="sha512-QKC1UZ/ZHNgFzVKSAhV5v5j73eeL9EEN289eKAEFaAjgAiobVAnVv/AGuPbXsKl1dNoel3kNr6PYnSiTzVVBCw==" crossorigin="anonymous" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css" integrity="sha512-QKC1UZ/ZHNgFzVKSAhV5v5j73eeL9EEN289eKAEFaAjgAiobVAnVv/AGuPbXsKl1dNoel3kNr6PYnSiTzVVBCw==" crossorigin="anonymous"></noscript>
  
  <link rel="preload" href="https://h-neco.github.io/css/resume.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://h-neco.github.io/css/resume.css"></noscript>
  <link rel="preload" href="https://h-neco.github.io/css/tweaks.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://h-neco.github.io/css/tweaks.css"></noscript>
  <link rel="preload" href="https://h-neco.github.io/css/resume-override.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://h-neco.github.io/css/resume-override.css"></noscript>
  <meta name="generator" content="Hugo 0.111.3">
  
   
  
</head>
<body id="page-top">
  <nav class="navbar navbar-expand-lg navbar-dark bg-profile fixed-top" id="sideNav">
  <a class="navbar-brand js-scroll-trigger" href="#page-top">
    <span class="d-block d-lg-none">h neco</span>
    <span class="d-none d-lg-block">
      <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="/img/profile.png" alt="">
    </span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link js-scroll-trigger" href="/#about">About</a>
      </li>
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="/#skills">Skills</a>
          </li>
      
      
      
      
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="/#experience">Experience</a>
          </li>
      
      
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="/#blog">Blog</a>
          </li>
      
    </ul>
  </div>
</nav>

  <div class="container-fluid p-0">
    
<nav aria-label="breadcrumb">
  <ol  class="breadcrumb">
    



<li class="breadcrumb-item">
  <a href="https://h-neco.github.io/">Home</a>
</li>


<li class="breadcrumb-item active">
  <a href="https://h-neco.github.io/blog/">Blog</a>
</li>

  </ol>
</nav>




<section class="resume-section p-3 p-lg-5 d-flex flex-column">
  <div class="my-auto" id="projects-content">
    <h1 id="blog">Blog</h1>
    <p><p>技術に興味を持つ方々に有益な情報を提供するを目標としてますが、品質よりもアウトプットの効率性を重視しています。そのため、記事にいくつか誤りや割愛していることあることがありますが、ご了承ください。</p>
</p>
    
      
        
<div class="resume-item d-flex flex-row mb-5">
  <div class="publication-content mr-auto">
    <h3 class="mb-0"><a href="https://h-neco.github.io/blog/vm-multipass/">multipassでの仮想マシンの作成/Docker環境構築</a></h3>
    <div>Intro 以前は、vagrant+virtualbox で仮想マシンを作成してましたが、m2 mac に端末を変えたため、multipass に切り替えました。
multipass は、Ubuntu の仮想マシンを簡単に作成できるツールです。multipass を使用することで、仮想マシンの作成、起動、停止、削除などの操作を簡単に行うことができます。
install $ brew install multipass ==&gt; Installing Cask multipass ==&gt; Running installer for multipass with sudo; the password may be necessary. Password: installer: Package name is multipass installer: Installing at base path / installer: The install was successful. 🍺 multipass was successfully installed! $ multipass version multipass 1.13.1+mac multipassd 1.13.1+mac 基本コマンド 詳しくは以下参照 https://multipass.run/docs/multipass-cli-client # 新規作成 $ multipass launch -n test-vm-01 Launched: test-vm-01 # 確認 $ multipass list Name State IPv4 Image test-vm-01 Running 192.</div>
    <div><ul class="tags">
    
</ul>
</div>
  </div>
  <div class="resume-date text-md-right flex-col">
    <span class="text-primary">March 20, 2024</span>
  </div>
</div>

      
    
      
        
<div class="resume-item d-flex flex-row mb-5">
  <div class="publication-content mr-auto">
    <h3 class="mb-0"><a href="https://h-neco.github.io/blog/chatgpt-mermaid/">ChatGPT&#43;Mermaidでシーケンス図を作成する</a></h3>
    <div>ChatGPT+Mermaid でシーケンス図を作成する ChatGPT と Mermaid を使って、シーケンス図を作成してみました。
ChatGPT と Mermaid を組み合わせることで、シーケンス図を簡単に作成できます。ChatGPT は自然な文章生成に優れており、Mermaid はシンプルな記法でシーケンス図を描画できます。この組み合わせにより、手軽に要約や説明を行いながら、視覚的な図を生成できます。AI が生成したテキストを元に、Mermaid を使ってシーケンス図を作成することで、複雑なプロセスやアルゴリズムを視覚的に理解しやすくなります。
簡単なバッチの図を作成してみました プロンプトでの指示 「&ldquo;a&quot;が&quot;b&quot;に対して&quot;x&quot;を非同期で要求し、その後&quot;b&quot;の状態を確認し続けるというプロセスを Mermaid のシーケンス図で作成してください。状態が変更されていない場合は、&ldquo;a&quot;が状態確認を継続し、状態が変更された場合は、&ldquo;b&quot;が&quot;a&quot;にその旨を通知するシーケンスも図に含めてください。」
回答 あなたが求めているシーケンス図は、以下のような形になります。
mermaid sequenceDiagram participant a participant b a-&gt;&gt;b: xを非同期で要求 loop 状態確認 a-&gt;&gt;b: bの状態を確認 opt 変更なし a-&gt;&gt;a: 状態の確認を継続 end b--&gt;&gt;a: 状態変更あり end このシーケンス図は、&ldquo;a&quot;が&quot;b&quot;に非同期で&quot;x&quot;を要求し、その後&quot;b&quot;の状態を確認し続けるプロセスを表現しています。&ldquo;b&quot;の状態が変更されない場合、&ldquo;a&quot;は状態の確認を続けます。一方、&ldquo;b&quot;の状態が変更された場合、&ldquo;b&quot;は&quot;a&quot;にその旨を通知します。</div>
    <div><ul class="tags">
    
</ul>
</div>
  </div>
  <div class="resume-date text-md-right flex-col">
    <span class="text-primary">February 21, 2024</span>
  </div>
</div>

      
    
      
        
<div class="resume-item d-flex flex-row mb-5">
  <div class="publication-content mr-auto">
    <h3 class="mb-0"><a href="https://h-neco.github.io/blog/aws-cloudfront-functions/">CloudFrontFunctionとLambdaEdgeの違い</a></h3>
    <div>CloudFrontFunction / LambdaEdgeについて CloudFront Functionsは、Amazon CloudFrontのサービスであり、Lambda@Edgeより手前で動作し、シンプルな処理を高速かつ安価に実行できるように設計された機能です。従来のLambda@Edgeは、CloudFrontのエッジロケーションで動作するカスタムのAWS Lambda関数を作成して、リクエストまたはレスポンスを処理することができます。一方、CloudFront Functionsはよりシンプルで軽量であり、Lambda@Edgeよりも低いレイテンシと高いパフォーマンスを持っています。
CloudFront Functionsを使用すると、よりユーザーに近いエッジロケーションでリクエストを処理できるため、レスポンス時間が短縮され、ユーザーエクスペリエンスが向上します。また、コスト面でもLambda@Edgeよりも経済的であるため、シンプルな処理にはCloudFront Functionsが適しています。
さらに、CloudFront FunctionsとLambda@Edgeを組み合わせて使用することも可能です。例えば、シンプルな処理やヘッダーの操作、URLの書き換えなどのタスクをCloudFront Functionsで処理し、より高度な処理を必要とする場合にはLambda@Edgeで追加の処理を行うことができます。 これにより、より効率的で高速なコンテンツデリバリーサービスを提供することができるため、AWSのクラウドインフラストラクチャを活用したウェブアプリケーションやコンテンツの配信を行う際に便利です。
比較表 特徴 CloudFrontFunction Lambda@Edge ランタイムサポート JavaScript (ECMAScript 5.1準拠) Node.js、Python 実行場所 218 以上の CloudFront エッジロケーション 13 の CloudFront リージョンのエッジキャッシュ サポートされる CloudFront トリガー ビューアリクエスト、ビューアレスポンス、オリジンリクエスト、オリジンレスポンス ビューアリクエスト、ビューアレスポンス、オリジンリクエスト、オリジンレスポンス 最大実行時間 1 ミリ秒未満 5 秒 (ビューアトリガー)、30 秒 (オリジントリガー) 最大メモリ 2 MB 128 MB (ビューアトリガー)、10 GB (オリジントリガー) 合計パッケージサイズ 10 KB 1 MB (ビューアトリガー)、50 MB (オリジントリガー) ネットワークアクセス なし あり ファイルシステムアクセス なし あり リクエスト本文へのアクセス なし あり 料金 無料利用枠あり。リクエストごとに課金。 無料利用枠なし。リクエストと関数の実行時間ごとに課金。 まとめ・考察 どちらにするかは処理時間か鍵になりそうです。</div>
    <div><ul class="tags">
    
</ul>
</div>
  </div>
  <div class="resume-date text-md-right flex-col">
    <span class="text-primary">July 21, 2023</span>
  </div>
</div>

      
    
      
        
<div class="resume-item d-flex flex-row mb-5">
  <div class="publication-content mr-auto">
    <h3 class="mb-0"><a href="https://h-neco.github.io/blog/docker-terraform/">dockerでterraformを実行する</a></h3>
    <div>はじめに dockerでterraformを実行するためのdocker-compose.ymlを作成しました。
メリット 環境の統一 Dockerは環境の統一を容易にします。異なるプラットフォームやOSで作業している場合でも、Dockerコンテナ内でTerraformを実行することで、実行環境を一貫させることができます。 バージョン管理 Terraformのバージョン管理は重要です。異なるプロジェクトや環境で複数のTerraformバージョンを使用する場合、Dockerコンテナ内でTerraformを実行することで、各プロジェクトや環境ごとに適切なTerraformバージョンを管理することができます。 windowsユーザーはtfenvが使えないので、dockerで管理するのが良いかと思います。 やること 環境変数のセット export AWS_DEFAULT_REGION=ap-northeast-1 export AWS_ACCESS_KEY_ID=xxxxxx export AWS_SECRET_ACCESS_KEY=xxxxxx docker-compose.ymlファイルの作成 version: &#34;3&#34; services: terraform: image: hashicorp/terraform:1.5.2 platform: linux/x86_64 volumes: - ~/.aws:/root/.aws - ./:/workdir working_dir: &#34;/workdir&#34; environment: - AWS_ACCESS_KEY_ID - AWS_SECRET_ACCESS_KEY - AWS_DEFAULT_REGION entrypoint: sh -c &#39;terraform init &amp;&amp; terraform workspace select &#34;${WORKSPACE}&#34; 2&gt;/dev/null || terraform workspace new &#34;${WORKSPACE}&#34; &amp;&amp; terraform &#34;${COMMAND}&#34;&#39; terraformの実行 # コードフォーマッターの実行 export WORKSPACE=&#34;prod&#34; COMMAND=&#34;fmt&#34; &amp;&amp; docker-compose -p プロジェクト名 run --rm terraform # コード構文チェックの実行 export WORKSPACE=&#34;prod&#34; COMMAND=&#34;validate&#34; &amp;&amp; docker-compose -p プロジェクト名 run --rm terraform # 実行計画の確認 export WORKSPACE=&#34;prod&#34; COMMAND=&#34;plan&#34; &amp;&amp; docker-compose -p プロジェクト名 run --rm terraform </div>
    <div><ul class="tags">
    
</ul>
</div>
  </div>
  <div class="resume-date text-md-right flex-col">
    <span class="text-primary">July 10, 2023</span>
  </div>
</div>

      
    
      
        
<div class="resume-item d-flex flex-row mb-5">
  <div class="publication-content mr-auto">
    <h3 class="mb-0"><a href="https://h-neco.github.io/blog/aws-codebuild/">codebuild構築とdeployフローの整備</a></h3>
    <div>はじめに BitBucketPipelinesでimageのpushを行っていましたが、cpuがマルチプラットフォームに対応しておらず、x86_64のみしか対応していないため、イメージのpushをCodeBuildで行うことにしました。 arm64でECSタスクを実行するとコストが20％落ち、使い方によってはパフォーマンスが向上するらしい。
今まで [BitBucketPipelines]　→　[awsECR] 変更後 [BitBucketPipelines]　→　[awsCodeBuild]　→　[awsECR] 結果 コストが20%ぐらい落ちた。パフォーマンスはまだサービスインしてないため分からない
やること CodeBuildの設定 構成 /image/以下のDockerfileをbuildしてECRにpushする /image/以下にbuildspec.ymlを配置 BitbucketからCodeBuildを実行するためのscript用意 bitbuket-pipelines.ymlの修正 CodeBuildの設定 data &#34;aws_region&#34; &#34;this&#34; {} resource &#34;aws_codebuild_project&#34; &#34;ecr&#34; { badge_enabled = false build_timeout = 20 // 20分 concurrent_build_limit = 1 // 並列実行数 encryption_key = &#34;arn:aws:kms:${data.aws_region.this.name}:${data.aws_caller_identity.self.account_id}:alias/aws/s3&#34; name = &#34;ecr-build-${terraform.workspace}&#34; project_visibility = &#34;PRIVATE&#34; queued_timeout = 480 service_role = aws_iam_role.codebuild_role.arn tags = { Environment = &#34;${terraform.workspace}&#34; Name = &#34;ecr-build-${terraform.workspace}&#34; } environment { compute_type = &#34;BUILD_GENERAL1_SMALL&#34; // 1vCPU, 3.</div>
    <div><ul class="tags">
    
</ul>
</div>
  </div>
  <div class="resume-date text-md-right flex-col">
    <span class="text-primary">June 27, 2023</span>
  </div>
</div>

      
    
      
        
<div class="resume-item d-flex flex-row mb-5">
  <div class="publication-content mr-auto">
    <h3 class="mb-0"><a href="https://h-neco.github.io/blog/aws-efs/">EFS Burst Mode のクレジット枯渇対策メモ</a></h3>
    <div>Intro EFSバーストモードのクレジット枯渇対策メモ EFSをバーストモードで使用していて、クレジットが不足してきたため、私が取った対策をメモとして提供します。 技術要素 EFS aws EFSの2つのモード EFSには2つのモードがあります: バーストモード（汎用）とプロビジョンドモード。
バーストモードは、使用されているストレージの量に基づいてトラフィックを自動的に調整し、一時的なトラフィックの増加に対応できます。バースト可能な帯域幅はトラフィックの使用状況によって異なり、最低105 Mbpsのバーストが可能です。ただし、1秒あたりの読み取り/書き込みリクエストの数には制限があり、制限を超えるとスループットが低下する可能性があります。
プロビジョンドモードでは、ボリュームのスループット、最小/最大/バースト、および書き込みスループットを設定できます。読み取りスループットは書き込みスループットの3倍です。プロビジョンドモードはトラフィックに基づいた自動スケーリングはありませんが、スループットの設定に基づいて必要なトラフィックに対応できます。
バーストモード（汎用）の注意事項と対策 バーストモード（汎用）の注意事項と対策
注意事項1: バーストクレジット
バーストモードは、ファイルの読み取り/書き込み操作から蓄積されたクレジットを消費し、NAS上のデータ使用状況に基づいてクレジットを補充します。バーストモードの最低速度は105 Mbpsです。ただし、バーストクレジットが枯渇すると、スループットの性能が著しく低下し、マウントシステムからのファイル参照がタイムアウトする場合があります。
確認方法:
メトリック名: BurstCreditBalance 最初に2.3Tのクレジットが提供されます。 バーストクレジットの枯渇を避けるためには、以下の対策を取ることができます:
クレジットの回復を加速するために大量のデータを配置する。 プロビジョンドモードに切り替えて一定のスループットを確保する。 注意事項2: リクエスト制限
バーストモードにはリクエストの制限があります。 リード用の最大IOPSは35,000、ライト用の最大IOPSは7,000です。 バーストモードの最大IOPSを超えると、スループットのパフォーマンスが低下します。したがって、高いIOPSが必要な場合は、プロビジョンドモードの使用を検討してください。 確認方法: メトリック名: PercentIOLimit 検討に基づく対策の取得 バーストモードに大量のデータを配置してクレジットの回復速度を加速するという戦略を採用しました。
10GBのファイルを配置する試み。 コスト: $3/月 コマンド: $ dd if=/dev/zero of=10GB_file_1 bs=10240k count=1000 確認方法: メトリック名: BurstCreditBalance 高いコストのため、プロビジョンドモードは使用していません。 スループット 33(Mib/s) / 最大読み取りスループット 99(Mib/s) コスト: $238/月 スループット 15(Mib/s) / 最大読み取りスループット 45(Mib/s) コスト: $108/月 スループット 5(Mib/s) / 最大読み取りスループット 15(Mib/s) コスト: $36/月 </div>
    <div><ul class="tags">
    
</ul>
</div>
  </div>
  <div class="resume-date text-md-right flex-col">
    <span class="text-primary">May 3, 2023</span>
  </div>
</div>

      
    
      
        
<div class="resume-item d-flex flex-row mb-5">
  <div class="publication-content mr-auto">
    <h3 class="mb-0"><a href="https://h-neco.github.io/blog/aws-ec2-ebs-delete-on-termination/">Persisting an Attached EBS Volume to EC2 Using AWS CLI.</a></h3>
    <div>Intro デフォルトでは、EC2インスタンスが終了すると、アタッチされたEBSボリュームも削除されます。しかし、AWS CLIを使用してこれらを永続化する方法を探ってみましょう。 技術要素 EC2/EBS コマンド タグによってフィルタリングされた対象インスタンスのボリューム情報を取得します。 DeleteOnTerminationがtrueである場合、ボリュームは永続化されていないことを意味します。 $ aws ec2 describe-instances --filters &#34;Name=tag:Name,Values=xxxxx-prod-web01&#34; | jq -r .Reservations[0].Instances[0].BlockDeviceMappings [ { &#34;DeviceName&#34;: &#34;/dev/sda1&#34;, &#34;Ebs&#34;: { &#34;AttachTime&#34;: &#34;2023-04-18T04:59:14+00:00&#34;, &#34;DeleteOnTermination&#34;: true, &#34;Status&#34;: &#34;attached&#34;, &#34;VolumeId&#34;: &#34;vol-xxxxxxxxxxxx&#34; } } ] 設定ファイルを準備します。 DeleteOnTerminationをfalseに設定します。 $ vim mapping.json [ { &#34;DeviceName&#34;: &#34;/dev/sda1&#34;, &#34;Ebs&#34;: { &#34;DeleteOnTermination&#34;: false } } ] インスタンスの設定変更 $ aws ec2 modify-instance-attribute --instance-id &#34;i-xxxxxxxxxxxxxx&#34; --block-device-mappings file://mapping.json タグでフィルタリングされた対象インスタンスのボリューム情報を取得します。 DeleteOnTerminationがfalseであることを確認します。 $ aws ec2 describe-instances --filters &#34;Name=tag:Name,Values=xxxxx-prod-web01&#34; | jq -r .</div>
    <div><ul class="tags">
    
</ul>
</div>
  </div>
  <div class="resume-date text-md-right flex-col">
    <span class="text-primary">May 3, 2023</span>
  </div>
</div>

      
    
      
        
<div class="resume-item d-flex flex-row mb-5">
  <div class="publication-content mr-auto">
    <h3 class="mb-0"><a href="https://h-neco.github.io/blog/cicd-oidc/">OIDCでのデプロイメモ (Git to AWS)</a></h3>
    <div>Intro 以前は、GitHubやBitbucketから個人のAWSへのデプロイ時にアクセスキーとシークレットキーを使用していました。しかし、これを管理するのが煩雑になったため、OIDCに切り替えました。
OIDC (OpenID Connect) は、認証と認可のためのオープンスタンダードです。OIDCを使用することで、AWSへのアクセスを安全に管理し、認証プロバイダを介してシームレスなアクセス体験を提供できます。OIDCを使用する場合、AWSへのアクセスにはアクセストークンが使用されます。
OIDCを導入することで、アクセスキーやシークレットキーを個別に管理する必要がなくなり、セキュリティと利便性が向上します。
やること TerraformでOIDCを設定する方法 GitHub Bitbucket OIDCを使用してデプロイする方法 シンプルなGitHub ActionsとBitbucket Pipelinesの作成 技術要素 OIDC AWS Bitbucket GitHub Terraform What is OIDC? OIDC（OpenID Connect）は、OAuth 2.0プロトコルを拡張し、Webアプリケーションやモバイルアプリケーションにおけるユーザー認証の仕組みを提供する認証プロトコルです。
Benefits of OIDC GitからのデプロイにOIDCを使用することで、いくつかの利点があります。それには、Gitを介したデプロイのセキュリティの向上、トークンの有効期限の管理の容易化、MFAが有効化されていないアクセスキーの使用に関連するセキュリティリスクの回避などがあります。ただし、MFAが有効化されたアクセスキーを使用する場合は、デバイス管理などの要素を考慮する必要があるため、複雑な場合があります。OIDCを使用することで、ユーザーはIDプロバイダーの認証資格情報を使用できるため、認証情報の管理が簡素化され、セキュリティが向上します。
構築背景 以前は、AWSへのデプロイは手間がかかるものでした。CLIの代わりに管理コンソールからデプロイすることを考えるほどです。
以前のフローでは、キーの取得に不便さが伴いました： アプリからMFAトークンを確認してコマンドを実行する： $ aws sts get-session-token &ndash;serial-number arn:aws:iam::xxxxxx:mfa/xxxxxx &ndash;token-code xxxxxx 取得したキーをエクスポートするか、Gitに登録する セッションの有効期限が切れるたびに定期的にコマンドを実行する&hellip; TerraformでOIDCを構築する Terraformでの構築 GitHub Actionsを使用するシナリオとBitbucket Pipelinesを使用するシナリオの2つを説明します。 GitHub Sample variable &#34;aws_account_id&#34; {} variable &#34;github_repo_name&#34; {} variable &#34;oidc_token_url&#34; { default = &#34;https://token.actions.githubusercontent.com&#34; } data &#34;tls_certificate&#34; &#34;github_oidc_token&#34; { url = var.</div>
    <div><ul class="tags">
    
</ul>
</div>
  </div>
  <div class="resume-date text-md-right flex-col">
    <span class="text-primary">April 26, 2023</span>
  </div>
</div>

      
    
      
        
<div class="resume-item d-flex flex-row mb-5">
  <div class="publication-content mr-auto">
    <h3 class="mb-0"><a href="https://h-neco.github.io/blog/aws-lambda-local-execution/">Lambdaローカル開発環境構築メモ (SAM | LocalStack | TypeScript)</a></h3>
    <div>Intro PC の入れ替えに伴い、Lambda のローカル実行環境を再構築した。メモとして残しておきます。 PC リプレースのついでに Lambda のローカル実行環境を再構築。メモとして残しておく。
技術要素 Volta Lambda LocalStack TypeScript SAM 前提条件 Installing Volta Volta のインストール Volta は Node.js のバージョン管理に特化したツールです。プロジェクトごとに異なる Node.js のバージョンを切り替えることができ、Node.js のバージョンを手動でインストール・管理することなく、異なるバージョンを簡単に管理することができます。Volta は、他のバージョン管理ツールと比較して切り替えが簡単という利点があり、OS やシェルに依存しないため様々な環境で利用することができます。
$ curl https://get.volta.sh | bash $ echo &#39;export VOLTA_HOME=&#34;$HOME/.volta&#34;&#39; &gt;&gt; .zshrc $ echo &#39;export PATH=&#34;$VOLTA_HOME/bin:$PATH&#34;&#39; &gt;&gt; .zshrc Node.js と Yarn のインストール 利用可能なバージョンを確認するには、volta list node を使用します。特定のバージョンをインストールしたい場合は、volta install node@18.15.0 というフォーマットを使ってください。
$ volta install node success: installed and set node@18.15.0 (with npm@9.5.0) as default $ volta install yarn success: installed and set yarn@4.</div>
    <div><ul class="tags">
    
</ul>
</div>
  </div>
  <div class="resume-date text-md-right flex-col">
    <span class="text-primary">April 24, 2023</span>
  </div>
</div>

      
    
      
        
<div class="resume-item d-flex flex-row mb-5">
  <div class="publication-content mr-auto">
    <h3 class="mb-0"><a href="https://h-neco.github.io/blog/cicd-terragrunt-1/">TerraformのWrapperツール、Terragrunt導入の検証を行いました。</a></h3>
    <div>Intro TerraformのWrapperツール、Terragrunt導入の検証を行いました。 導入の検証 通常、私はTerraformを使用していますが、次のような不便さがありました： 各デプロイの影響範囲を最小限に抑えるために、Gitリポジトリをより小さなものに分割する必要がありました。Terraformのバージョンアップが面倒でした。 コードからリソースの依存関係を理解するのが難しかったです。 depends_onが明示的に使用できない場所でデプロイ順序に注意する必要がありました。 導入後の課題 導入に関して、以下の2点について検証が保留されています。もし詳しい方がいたら相談に乗っていただけると幸いです。 Terraformの管理だけでなく、Terragruntのバージョン管理も行う必要があります。バージョンアップのプロセスはどのように変わるのか もしTerragruntの開発が停止した場合、スムーズにTerraformのコードに戻せるか 技術要素 terraform terragrunt aws Terragruntとは Terragruntは、Terraformを使用してインフラストラクチャを管理するための作業を簡素化するためのTerraform Wrapperとして知られるオープンソースのツールです。TerragruntはTerraformが提供する機能を拡張し、モジュールのコード再利用、柔軟な構成、再利用性の向上を可能にします。特に、Terraformを使用して複数の環境やアカウントを管理する際にTerragruntは非常に便利です。
インストール $ brew install tfenv # Installs Terraform (version specified in .terraform-version) $ brew install tgenv # Installs Terragrunt (version specified in .terragrunt-version) ###　フォルダ構成
このフォルダ構成は、他の記事を参考に作成されました。この構造の利点は、各環境ごとに異なる変数を指定できるため、コードの再利用性が向上することです。
$ tree . . ├── README.md ├── docs │ └── graph-dependencies.png ├── envs │ ├── prod │ │ ├── ResourceGroupA │ │ │ └── terragrunt.hcl │ │ ├── ResourceGroupB │ │ │ └── terragrunt.</div>
    <div><ul class="tags">
    
</ul>
</div>
  </div>
  <div class="resume-date text-md-right flex-col">
    <span class="text-primary">April 22, 2023</span>
  </div>
</div>

      
    
      
        
<div class="resume-item d-flex flex-row mb-5">
  <div class="publication-content mr-auto">
    <h3 class="mb-0"><a href="https://h-neco.github.io/blog/aws-ec2-nat-instance/">PackerとAnsibleを使用してAmazon Linux 2にNATインスタンスを作成します。</a></h3>
    <div>Intro AmazonLinux2を使用してNATインスタンスを設定しました。構成プロセスにPackerとAnsibleを使用しました。
AmazonLinux2を使用してNATインスタンスを設定します。 Amazonlinux2が選択する理由 Lambdaは外部から開始される着信接続をサポートしていないため、アクティブモードでFTPをサポートしません。 ECSは、プライベートIPアドレスの静的割り当てを許可していません。 Gatewayタイプであるため、NATプライベートゲートウェイと組み合わせることで静的割り当てを実現することは可能ですが、外部ソースからの着信接続を受け入れることはできません。 技術要素 Packer Ansible iptables CENTOS7（AmazonLinux2）では、デフォルトのファイアウォール管理システムはファイアウォールです。ただし、IPTablesを紹介して、NATインスタンスをセットアップします。 ファイル構造 $ tree . . ├── ansible.cfg ├── bin │ └── init.sh ├── inventory │ └── hosts ├── packer-template │ └── nat_instance.json ├── playbook │ └── setup.yml └── roles └── iptable └── tasks ├── main.yml └── templates ├── iptables-config.j2 ├── nat_cidr.j2 └── sysctl.conf Packerとテンプレートファイルの実行 Execution Command packer build packer-template/nat_instance.json . └── packer-template └── nat_instance.json { &#34;variables&#34;: { &#34;aws_access_key&#34;: &#34;{{env `AWS_ACCESS_KEY`}}&#34;, &#34;aws_secret_key&#34;: &#34;{{env `AWS_SECRET_KEY`}}&#34; }, &#34;builders&#34;: [ { &#34;type&#34;: &#34;amazon-ebs&#34;, &#34;access_key&#34;: &#34;{{user `aws_access_key`}}&#34;, &#34;secret_key&#34;: &#34;{{user `aws_secret_key`}}&#34;, &#34;region&#34;: &#34;ap-northeast-1&#34;, &#34;ami_regions&#34;: [ &#34;ap-northeast-1&#34; ], &#34;associate_public_ip_address&#34;: true, &#34;source_ami&#34;: &#34;ami-0a3d21ec6281df8cb&#34;, &#34;instance_type&#34;: &#34;t3.</div>
    <div><ul class="tags">
    
</ul>
</div>
  </div>
  <div class="resume-date text-md-right flex-col">
    <span class="text-primary">April 11, 2023</span>
  </div>
</div>

      
    
      
        
<div class="resume-item d-flex flex-row mb-5">
  <div class="publication-content mr-auto">
    <h3 class="mb-0"><a href="https://h-neco.github.io/blog/browser-selenium/">ブラウザのコンソールログをSelenium(ヘッドレスブラウザ)で取得する</a></h3>
    <div>背景 NFSからs3へデータを移行してWEBホスティングするように基盤移行を行った際、404のオブジェクトが多数発生していた。 また、s3のオブジェクト名・プレフィックス名には禁則文字というものが存在するうらしい。 何が対象なのか判断するために、ブラウザのコンソールログを取得する必要があった。
動作環境 環境・ツール
$ sw_vers ProductName: Mac OS X ProductVersion: 10.15.2 BuildVersion: 19C57 $ python3 -V Python 3.7.3z $ pip3 list | grep -e chrome -e selenium chromedriver-binary 83.0.4103.39.0 selenium 3.141.0 install手順
$ sudo pip3 install selenium $ sudo pip3 install chromedriver-binary==83.0.4103.39.0 技術要素 selenium web driver python ec2 ファイル構成 ./log/ (ログ出力先ディレクトリ) ./config.ini (設定ファイル) ./grep.py (実行ファイル) ./url.txt (検索対象のURLリスト) 実行準備 クローリング対象のURLを記載する $ vi url.txt http://user:password@google.com/ http://www.google.com/ ... configファイルの配置 $ vi config.</div>
    <div><ul class="tags">
    
</ul>
</div>
  </div>
  <div class="resume-date text-md-right flex-col">
    <span class="text-primary">August 26, 2020</span>
  </div>
</div>

      
    
      
        
<div class="resume-item d-flex flex-row mb-5">
  <div class="publication-content mr-auto">
    <h3 class="mb-0"><a href="https://h-neco.github.io/blog/list/">List</a></h3>
    <div>devops multipass で ローカル docker 環境の構築 2024-03-20 Docker から Terraform を実行する 2023-07-10 Codebuild 構築と Deploy フローの整備 2023-06-27 Terraform のラッパーツール、Terragrunt の導入検証を行ってみた 2023-04-27 OIDC (Git to AWS)のデプロイメモ 2023-04-26 aws CloudFrontFunction と LambdaEdge の違い 2023-07-21 EFS バーストモードクレジット枯渇対策メモ 2023-05-03 AWS CLI を使った EC2 への EBS ボリュームの永続化 2023-05-01 Lambda ローカル開発環境構築メモ (SAM | LocalStack | TypeScript) 2023-04-24 Packer と Ansible を使って Amazon Linux 2 に NAT インスタンスを作成する 2023-04-11 security Trivy を用いたコンテナへの脆弱性診断 2024-03-20 その他 ブラウザのコンソールログを Selenium(ヘッドレスブラウザ)で取得する 2020-08-26 chatgpt+mermaid でシーケンス図を作成する 2024-02-21 </div>
    <div><ul class="tags">
    
</ul>
</div>
  </div>
  <div class="resume-date text-md-right flex-col">
    <span class="text-primary">January 1, 0001</span>
  </div>
</div>

      
    
    
  </div>
</section>

    <section><span style="color: #999999;">Nifty <a href="https://codepen.io/wbeeftink/pen/dIaDH">tech tag lists</a> from <a class="pen-owner-link" href="https://codepen.io/wbeeftink">Wouter Beeftink</a> </span>
      
    </section>
  </div>
  
  <script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js" integrity="sha512-0QbL0ph8Tc8g5bLhfVzSqxe9GERORsKhIn1IrpxDAgUsbBGz/V7iSav2zzW325XGd1OMLdL4UiqRJj702IeqnQ==" crossorigin="anonymous"></script>
  
  <script async src="/js/resume.js"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z6BYZ5M6VX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-Z6BYZ5M6VX');
  </script>
  

  
</body>
</html>
