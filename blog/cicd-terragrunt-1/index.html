<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>profile | I Conducted a Validation of Introducing Terragrunt, a Wrapper for Terraform.</title>
  <meta name="description" content="">

  
  
    <meta property="og:image" content="https://h-neco.github.io/img/profile.png" />
    <meta property="og:title" content="profile | I Conducted a Validation of Introducing Terragrunt, a Wrapper for Terraform." />   
  
  <meta property="og:description" content="" />
  <meta name="author" content="h neco">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900&display=swap"></noscript>
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
      <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap"></noscript>
  <link rel="preload" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css"></noscript>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/devicons/1.8.0/css/devicons.min.css" integrity="sha512-JW3fT0YTK7pT7w437SoX6GcW76jOZ6E0jGmrqBAcloC4GKT+njHOY4fX5KxJ9WfIXTkNrAF994525fAHp+KCxg==" crossorigin="anonymous" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/devicons/1.8.0/css/devicons.min.css" integrity="sha512-JW3fT0YTK7pT7w437SoX6GcW76jOZ6E0jGmrqBAcloC4GKT+njHOY4fX5KxJ9WfIXTkNrAF994525fAHp+KCxg==" crossorigin="anonymous"></noscript>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css" integrity="sha512-QKC1UZ/ZHNgFzVKSAhV5v5j73eeL9EEN289eKAEFaAjgAiobVAnVv/AGuPbXsKl1dNoel3kNr6PYnSiTzVVBCw==" crossorigin="anonymous" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css" integrity="sha512-QKC1UZ/ZHNgFzVKSAhV5v5j73eeL9EEN289eKAEFaAjgAiobVAnVv/AGuPbXsKl1dNoel3kNr6PYnSiTzVVBCw==" crossorigin="anonymous"></noscript>
  
  <link rel="preload" href="https://h-neco.github.io/css/resume.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://h-neco.github.io/css/resume.css"></noscript>
  <link rel="preload" href="https://h-neco.github.io/css/tweaks.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://h-neco.github.io/css/tweaks.css"></noscript>
  <link rel="preload" href="https://h-neco.github.io/css/resume-override.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://h-neco.github.io/css/resume-override.css"></noscript>
  <meta name="generator" content="Hugo 0.111.3">
  
   
  
</head>
<body id="page-top">
  <nav class="navbar navbar-expand-lg navbar-dark bg-profile fixed-top" id="sideNav">
  <a class="navbar-brand js-scroll-trigger" href="#page-top">
    <span class="d-block d-lg-none">h neco</span>
    <span class="d-none d-lg-block">
      <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="/img/profile.png" alt="">
    </span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link js-scroll-trigger" href="/#about">About</a>
      </li>
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="/#skills">Skills</a>
          </li>
      
      
      
      
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="/#experience">Experience</a>
          </li>
      
      
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="/#blog">Blog</a>
          </li>
      
    </ul>
  </div>
</nav>

  <div class="container-fluid p-0">
    
<nav aria-label="breadcrumb">
  <ol  class="breadcrumb">
    





<li class="breadcrumb-item">
  <a href="https://h-neco.github.io/">Home</a>
</li>


<li class="breadcrumb-item">
  <a href="https://h-neco.github.io/blog/">Blog</a>
</li>


<li class="breadcrumb-item active">
  <a href="https://h-neco.github.io/blog/cicd-terragrunt-1/">I Conducted a Validation of Introducing Terragrunt, a Wrapper for Terraform.</a>
</li>

  </ol>
</nav>




<section class="resume-section p-3 p-lg-5 d-flex flex-column">
  <div class="my-auto">
  	<div class="mb-3 d-flex flex-row justify-content-between">
    	<h2 class="mb-0"><span class="text-primary">I Conducted a Validation of Introducing Terragrunt, a Wrapper for Terraform.</span></h2>
    	<span class="">April 22, 2023</span>
    </div>
    <div>
    	<h2 id="intro">Intro</h2>
<ul>
<li>I Conducted a Validation of Introducing Terragrunt, a Wrapper for Terraform.</li>
</ul>
<h3 id="introduction-validation">Introduction Validation</h3>
<ul>
<li>Although I usually use Terraform, I found the following inconveniences:
<ul>
<li>To minimize the impact scope of each deployment, I had to split Git repositories into smaller ones.
<ul>
<li>Upgrading Terraform versions became challenging.</li>
</ul>
</li>
<li>It was difficult to understand resource dependencies from the code.
<ul>
<li>There was a need to be mindful of the deployment order in areas where depends_on couldn&rsquo;t be explicitly used.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="challenges-after-implementation">Challenges After Implementation</h3>
<ul>
<li>The introduction is pending validation for the following two points:
<ul>
<li>Not only managing Terraform but also managing Terragrunt versions. How does the version upgrade process change?</li>
<li>If Terragrunt development stops, can we smoothly revert back to Terraform code?</li>
</ul>
</li>
</ul>
<h3 id="technical-components">Technical Components</h3>
<ul>
<li>terraform</li>
<li>terragrunt</li>
<li>aws</li>
</ul>
<h3 id="prerequisites">Prerequisites</h3>
<h4 id="what-is-terragrunt">What is terragrunt?</h4>
<p>Terragrunt is an open-source tool known as a Terraform Wrapper, designed to simplify the management of infrastructure using Terraform. It extends the capabilities provided by Terraform, allowing for code reuse, increased reusability, and flexibility in configuring modules. Terragrunt is especially useful when managing multiple environments or accounts using Terraform.</p>
<h3 id="installation">Installation</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ brew install tfenv # Installs Terraform (version specified in .terraform-version)
</span></span><span style="display:flex;"><span>$ brew install tgenv # Installs Terragrunt (version specified in .terragrunt-version)
</span></span></code></pre></div><h3 id="folder-structure">Folder Structure</h3>
<p>This folder structure was created based on references from other articles. The advantage of this structure is that it allows for specifying different variables for each environment, resulting in increased code reusability.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ tree .
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── README.md
</span></span><span style="display:flex;"><span>├── docs
</span></span><span style="display:flex;"><span>│   └── graph-dependencies.png
</span></span><span style="display:flex;"><span>├── envs
</span></span><span style="display:flex;"><span>│   ├── prod
</span></span><span style="display:flex;"><span>│   │   ├── ResourceGroupA
</span></span><span style="display:flex;"><span>│   │   │   └── terragrunt.hcl
</span></span><span style="display:flex;"><span>│   │   ├── ResourceGroupB
</span></span><span style="display:flex;"><span>│   │   │   └── terragrunt.hcl
</span></span><span style="display:flex;"><span>│   │   └── env.hcl
</span></span><span style="display:flex;"><span>│   └── terragrunt.hcl
</span></span><span style="display:flex;"><span>└── modules
</span></span><span style="display:flex;"><span>    ├── ResourceGroupA
</span></span><span style="display:flex;"><span>    │   └── xx.tf
</span></span><span style="display:flex;"><span>    └── ResourceGroupB
</span></span><span style="display:flex;"><span>        └── xx.tf
</span></span></code></pre></div><h3 id="common-file-envsterragrunthcl">Common File (envs/terragrunt.hcl)</h3>
<p>This file contains the configuration for storing *.tfstate files in an AWS S3 bucket as a backend, allowing each environment to have its own *.tfstate file stored within the S3 bucket. It also includes the provider definitions used by Terraform to create AWS resources. The configuration specifies different provider settings for each AWS region.</p>
<p>By managing the state of resources using *.tfstate files, conflicts can be avoided even when multiple people are working on the project.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># Configuration for storing *.tfstate files for each environment
</span></span><span style="display:flex;"><span>remote_state {
</span></span><span style="display:flex;"><span>  backend = &#34;s3&#34;
</span></span><span style="display:flex;"><span>  config = {
</span></span><span style="display:flex;"><span>    bucket = &#34;tfstate-xxxxxxxxxxxxxx&#34;
</span></span><span style="display:flex;"><span>    # Stored in `stg/modA.tfstate`
</span></span><span style="display:flex;"><span>    key    = &#34;${path_relative_to_include()}.tfstate&#34;
</span></span><span style="display:flex;"><span>    region = &#34;ap-northeast-1&#34;
</span></span><span style="display:flex;"><span>    encrypt  = true
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  generate = {
</span></span><span style="display:flex;"><span>    path      = &#34;backend.tf&#34;
</span></span><span style="display:flex;"><span>    if_exists = &#34;overwrite&#34;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>generate &#34;provider&#34; {
</span></span><span style="display:flex;"><span>  path      = &#34;provider.tf&#34;
</span></span><span style="display:flex;"><span>  if_exists = &#34;overwrite_terragrunt&#34;
</span></span><span style="display:flex;"><span>  contents = &lt;&lt;EOF
</span></span><span style="display:flex;"><span>terraform {
</span></span><span style="display:flex;"><span>  required_version = &#34;&gt;= 1.3.7&#34;
</span></span><span style="display:flex;"><span>  required_providers {
</span></span><span style="display:flex;"><span>    aws = {
</span></span><span style="display:flex;"><span>      source = &#34;hashicorp/aws&#34;
</span></span><span style="display:flex;"><span>      version = &#34;~&gt; 4.53.0&#34;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Tokyo region
</span></span><span style="display:flex;"><span>provider &#34;aws&#34; {
</span></span><span style="display:flex;"><span>  region   = &#34;ap-northeast-1&#34;
</span></span><span style="display:flex;"><span>  alias  = &#34;tokyo&#34;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span># Virginia region
</span></span><span style="display:flex;"><span>provider &#34;aws&#34; {
</span></span><span style="display:flex;"><span>  region  = &#34;us-east-1&#34;
</span></span><span style="display:flex;"><span>  alias = &#34;virginia&#34;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span># ... Other regions
</span></span><span style="display:flex;"><span>EOF
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="environment-specific-file-envsprodenvhcl">Environment-Specific File (envs/prod/env.hcl)</h3>
<p>This file is an environment-specific file for terragrunt, containing the configuration for the prod environment. These variables are used in other terragrunt files to define environment-specific settings. Specifically, they are called in the hcl file of envs/prod/ResourceGroupA and passed as parameters to the Terraform code in module/ResourceGroupA.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>locals {
</span></span><span style="display:flex;"><span>  ENV    = &#34;prod&#34;
</span></span><span style="display:flex;"><span>  PROJECT_NAME = &#34;test&#34;
</span></span><span style="display:flex;"><span>  ACCOUNT_ID   = &#34;123456789&#34;
</span></span><span style="display:flex;"><span>  VPC_CIDE     = &#34;10.0.0.0/24&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="hcl-files-for-each-resource-grouping">HCL Files for Each Resource Grouping</h3>
<p>Let&rsquo;s provide an example of the hcl files for &ldquo;ResourceGroupA&rdquo; and &ldquo;ResourceGroupB&rdquo;.</p>
<p>Assuming there are no dependencies initially, we&rsquo;ll consider a clean slate scenario called A, with B being a resource grouping that depends on A.</p>
<p>Creating the hcl file for &ldquo;ResourceGroupA&rdquo;:</p>
<ul>
<li><code>vim envs/prod/ResourceGroupA/terragrunt.hcl</code></li>
<li>Receive variables from env.hcl and pass them as values to the module.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zed" data-lang="zed"><span style="display:flex;"><span>locals {
</span></span><span style="display:flex;"><span>  ENV <span style="color:#f92672">=</span> read_terragrunt_config(find_in_parent_folders(<span style="color:#960050;background-color:#1e0010">&#34;</span>env.hcl<span style="color:#960050;background-color:#1e0010">&#34;</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> Include <span style="color:#66d9ef">definition</span> of all environments (envs/terragrunt.hcl)
</span></span><span style="display:flex;"><span>include {
</span></span><span style="display:flex;"><span>  path <span style="color:#f92672">=</span> find_in_parent_folders()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>terraform {
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">#</span> Reference the module
</span></span><span style="display:flex;"><span>  source <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">&#34;</span>..<span style="color:#f92672">/</span>..<span style="color:#f92672">/</span>..<span style="color:#f92672">/</span>modules/<span style="color:#f92672">/</span>ResourceGroupA<span style="color:#960050;background-color:#1e0010">&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> Specify the input values for the module
</span></span><span style="display:flex;"><span>inputs <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  ENV          <span style="color:#f92672">=</span> local.ENV.locals.ENV
</span></span><span style="display:flex;"><span>  PROJECT_NAME <span style="color:#f92672">=</span> local.ENV.locals.PROJECT_NAME
</span></span><span style="display:flex;"><span>  ACCOUNT_ID   <span style="color:#f92672">=</span> local.ENV.locals.ACCOUNT_ID
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Creating the file for ResourceGroupB:
<ul>
<li>vim envs/prod/ResourceGroupB/terragrunt.hcl</li>
<li>Retrieve variables from env.hcl and pass values to the module.</li>
<li>The example assumes passing the VPC ID created in ResourceGroupA to ResourceGroupB.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zed" data-lang="zed"><span style="display:flex;"><span>locals {
</span></span><span style="display:flex;"><span>  ENV <span style="color:#f92672">=</span> read_terragrunt_config(find_in_parent_folders(<span style="color:#960050;background-color:#1e0010">&#34;</span>env.hcl<span style="color:#960050;background-color:#1e0010">&#34;</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> Include <span style="color:#66d9ef">definition</span> of all environments (envs/terragrunt.hcl)
</span></span><span style="display:flex;"><span>include {
</span></span><span style="display:flex;"><span>  path <span style="color:#f92672">=</span> find_in_parent_folders()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>terraform {
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">#</span> Reference the module
</span></span><span style="display:flex;"><span>  source <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">&#34;</span>..<span style="color:#f92672">/</span>..<span style="color:#f92672">/</span>..<span style="color:#f92672">/</span>modules/<span style="color:#f92672">/</span>ResourceGroupB<span style="color:#960050;background-color:#1e0010">&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> Specify the input values for the module
</span></span><span style="display:flex;"><span>inputs <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  ENV          <span style="color:#f92672">=</span> local.ENV.locals.ENV
</span></span><span style="display:flex;"><span>  PROJECT_NAME <span style="color:#f92672">=</span> local.ENV.locals.PROJECT_NAME
</span></span><span style="display:flex;"><span>  ACCOUNT_ID   <span style="color:#f92672">=</span> local.ENV.locals.ACCOUNT_ID
</span></span><span style="display:flex;"><span>  VPC_ID       <span style="color:#f92672">=</span> local.ENV.locals.VPC_ID
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="modules-tf-file">Module&rsquo;s tf file</h3>
<ul>
<li>In general, you can write Terraform code as usual.</li>
<li>If you want to receive parameters from other modules (in the case of dependencies or when passing parameters from env.hcl), you need to define empty variables in the variables block. In the example of ResourceGroupB mentioned above, it would look like the following:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>variable &#34;ENV&#34; {
</span></span><span style="display:flex;"><span>  description = &#34;Environment&#34;
</span></span><span style="display:flex;"><span>  type = string
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>variable &#34;PROJECT_NAME&#34; {
</span></span><span style="display:flex;"><span>  description = &#34;Project Name&#34;
</span></span><span style="display:flex;"><span>  type = string
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>variable &#34;vpc_id&#34; {
</span></span><span style="display:flex;"><span>  description = &#34;The ID of the VPC&#34;
</span></span><span style="display:flex;"><span>  type = string
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>If you want to pass parameters from one resource group to another, you need to define them as outputs. For example, in the case of Resource Group A, you would need to define them as follows:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>output &#34;vpc_id&#34; {
</span></span><span style="display:flex;"><span>  value = aws_vpc.main.id
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>macOS</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ brew tap aws/tap
</span></span><span style="display:flex;"><span>$ brew install aws-sam-cli
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sam --version
</span></span><span style="display:flex;"><span>SAM CLI, version 1.78.0
</span></span></code></pre></div><h2 id="deployment">Deployment</h2>
<h3 id="terragrunt-commands">Terragrunt Commands</h3>
<ul>
<li>Formatting:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cd envs/prod
</span></span><span style="display:flex;"><span>terragrunt run-all hclfmt
</span></span><span style="display:flex;"><span>terragrunt run-all fmt
</span></span></code></pre></div><ul>
<li>validate</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cd envs/prod
</span></span><span style="display:flex;"><span>terragrunt validate-all
</span></span></code></pre></div><ul>
<li>plan</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cd envs/prod
</span></span><span style="display:flex;"><span>terragrunt run-all plan
</span></span></code></pre></div><ul>
<li>apply</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cd envs/prod
</span></span><span style="display:flex;"><span>terragrunt run-all apply
</span></span></code></pre></div><ul>
<li>Dependency Graph
<ul>
<li>tips
<ul>
<li>Installing dot command on M1 Mac:
<ul>
<li>Graphviz is a graph visualization tool that includes the dot command. You can install Graphviz by running the following command in the terminal:</li>
<li><code>brew install graphviz</code></li>
<li>Verify if the dot command is installed:
<ul>
<li>dot -V</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cd envs/terragrunt-prod
</span></span><span style="display:flex;"><span>terragrunt graph-dependencies | dot -Tpng &gt; graph-dependencies.png
</span></span></code></pre></div><h2 id="deployment-from-git">Deployment from git</h2>
<h3 id="githubaction">GithubAction</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>name: Terragrunt Actions
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>on:
</span></span><span style="display:flex;"><span>  push:
</span></span><span style="display:flex;"><span>    branches:
</span></span><span style="display:flex;"><span>      - master
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>env:
</span></span><span style="display:flex;"><span>  TERRAGRUNT_CACHE_DIR: ${{ github.workspace }}/tool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jobs:
</span></span><span style="display:flex;"><span>  build:
</span></span><span style="display:flex;"><span>    runs-on: ubuntu-latest
</span></span><span style="display:flex;"><span>    env:
</span></span><span style="display:flex;"><span>      TARGET_ENV: &#39;&#39;
</span></span><span style="display:flex;"><span>    steps:
</span></span><span style="display:flex;"><span>      - name: Set Production
</span></span><span style="display:flex;"><span>        run: |
</span></span><span style="display:flex;"><span>          mkdir -p ${GITHUB_WORKSPACE}/deploy
</span></span><span style="display:flex;"><span>          echo &#39;export TARGET_ENV=&#34;prod&#34;&#39; &gt;&gt; ${GITHUB_WORKSPACE}/deploy/.env
</span></span><span style="display:flex;"><span>        if: github.ref == &#39;refs/heads/master&#39;
</span></span><span style="display:flex;"><span>        env:
</span></span><span style="display:flex;"><span>          GITHUB_WORKSPACE: ${{ github.workspace }}
</span></span><span style="display:flex;"><span>      - name: Set Staging
</span></span><span style="display:flex;"><span>        run: |
</span></span><span style="display:flex;"><span>          mkdir -p ${GITHUB_WORKSPACE}/deploy
</span></span><span style="display:flex;"><span>          echo &#39;export TARGET_ENV=&#34;stg&#34;&#39; &gt;&gt; ${GITHUB_WORKSPACE}/deploy/.env
</span></span><span style="display:flex;"><span>        if: github.ref == &#39;refs/heads/staging&#39;
</span></span><span style="display:flex;"><span>        env:
</span></span><span style="display:flex;"><span>          GITHUB_WORKSPACE: ${{ github.workspace }}
</span></span><span style="display:flex;"><span>      - name: Terragrunt Plan
</span></span><span style="display:flex;"><span>        env:
</span></span><span style="display:flex;"><span>          TERRAGRUNT_DOWNLOAD: &#34;https://github.com/gruntwork-io/terragrunt/releases/download/v0.34.0/terragrunt_linux_amd64&#34;
</span></span><span style="display:flex;"><span>        run: |
</span></span><span style="display:flex;"><span>          source ${GITHUB_WORKSPACE}/deploy/.env
</span></span><span style="display:flex;"><span>          sudo apt-get update &amp;&amp; sudo apt-get install -y curl unzip git
</span></span><span style="display:flex;"><span>          curl -Lo /tmp/terragrunt.zip ${TERRAGRUNT_DOWNLOAD}
</span></span><span style="display:flex;"><span>          sudo unzip -d /usr/local/bin /tmp/terragrunt.zip
</span></span><span style="display:flex;"><span>          cd ${GITHUB_WORKSPACE}/envs/${TARGET_ENV}
</span></span><span style="display:flex;"><span>          terragrunt run-all plan
</span></span><span style="display:flex;"><span>        if: github.ref == &#39;refs/heads/master&#39; || github.ref == &#39;refs/heads/staging&#39;
</span></span><span style="display:flex;"><span>        env:
</span></span><span style="display:flex;"><span>          GITHUB_WORKSPACE: ${{ github.workspace }}
</span></span><span style="display:flex;"><span>          TERRAGRUNT_CACHE_DIR: ${{ env.TERRAGRUNT_CACHE_DIR }}
</span></span><span style="display:flex;"><span>      - name: Terragrunt Apply
</span></span><span style="display:flex;"><span>        if: github.ref == &#39;refs/heads/master&#39;
</span></span><span style="display:flex;"><span>        env:
</span></span><span style="display:flex;"><span>          TERRAGRUNT_DOWNLOAD: &#34;https://github.com/gruntwork-io/terragrunt/releases/download/v0.34.0/terragrunt_linux_amd64&#34;
</span></span><span style="display:flex;"><span>        run: |
</span></span><span style="display:flex;"><span>          source ${GITHUB_WORKSPACE}/deploy/.env
</span></span><span style="display:flex;"><span>          sudo apt-get update &amp;&amp; sudo apt-get install -y curl unzip git
</span></span><span style="display:flex;"><span>          curl -Lo /tmp/terragrunt.zip ${TERRAGRUNT_DOWNLOAD}
</span></span><span style="display:flex;"><span>          sudo unzip -d /usr/local/bin /tmp/terragrunt.zip
</span></span><span style="display:flex;"><span>          cd ${GITHUB_WORKSPACE}/envs/${TARGET_ENV}
</span></span><span style="display:flex;"><span>          terragrunt run-all apply --terragrunt-non-interactive
</span></span><span style="display:flex;"><span>        env:
</span></span><span style="display:flex;"><span>          GITHUB_WORKSPACE: ${{ github.workspace }}
</span></span><span style="display:flex;"><span>          TERRAGRUNT_CACHE_DIR: ${{ env.TERRAGRUNT_CACHE_DIR }}
</span></span></code></pre></div><h3 id="bitbucket-pipelines">Bitbucket-Pipelines</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>image: hashicorp/terraform:1.3.7
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>definitions:
</span></span><span style="display:flex;"><span>  caches:
</span></span><span style="display:flex;"><span>    terragrunt: ${BITBUCKET_CLONE_DIR}/tool
</span></span><span style="display:flex;"><span>  steps:
</span></span><span style="display:flex;"><span>    - step: &amp;set-production
</span></span><span style="display:flex;"><span>        name: Set Production
</span></span><span style="display:flex;"><span>        script:
</span></span><span style="display:flex;"><span>          - mkdir -p ${BITBUCKET_CLONE_DIR}/deploy
</span></span><span style="display:flex;"><span>          - echo &#39;export TARGET_ENV=&#34;prod&#34;&#39; &gt;&gt; ${BITBUCKET_CLONE_DIR}/deploy/.env
</span></span><span style="display:flex;"><span>        artifacts:
</span></span><span style="display:flex;"><span>          - deploy/**
</span></span><span style="display:flex;"><span>    - step: &amp;set-staging
</span></span><span style="display:flex;"><span>        name: Set Staging
</span></span><span style="display:flex;"><span>        script:
</span></span><span style="display:flex;"><span>          - mkdir -p ${BITBUCKET_CLONE_DIR}/deploy
</span></span><span style="display:flex;"><span>          - echo &#39;export TARGET_ENV=&#34;stg&#34;&#39; &gt;&gt; ${BITBUCKET_CLONE_DIR}/deploy/.env
</span></span><span style="display:flex;"><span>        artifacts:
</span></span><span style="display:flex;"><span>          - deploy/**
</span></span><span style="display:flex;"><span>    - step: &amp;terragrunt-plan
</span></span><span style="display:flex;"><span>        name: terragrunt Plan
</span></span><span style="display:flex;"><span>        caches:
</span></span><span style="display:flex;"><span>          - terragrunt
</span></span><span style="display:flex;"><span>        script:
</span></span><span style="display:flex;"><span>          - source ${BITBUCKET_CLONE_DIR}/deploy/.env
</span></span><span style="display:flex;"><span>          - apk update &amp;&amp; apk add bash curl groff jq less unzip git
</span></span><span style="display:flex;"><span>          - if [ ! -d ${BITBUCKET_CLONE_DIR}/tool/tfenv ]; then git clone https://github.com/tfutils/tfenv.git ${BITBUCKET_CLONE_DIR}/tool/tfenv; fi
</span></span><span style="display:flex;"><span>          - if [ ! -d ${BITBUCKET_CLONE_DIR}/tool/tgenv ]; then git clone https://github.com/cunymatthieu/tgenv.git ${BITBUCKET_CLONE_DIR}/tool/tgenv; fi
</span></span><span style="display:flex;"><span>          - export PATH=${BITBUCKET_CLONE_DIR}/tool/tfenv/bin:$PATH
</span></span><span style="display:flex;"><span>          - export PATH=${BITBUCKET_CLONE_DIR}/tool/tgenv/bin:$PATH
</span></span><span style="display:flex;"><span>          - cd ${BITBUCKET_CLONE_DIR}/envs/${TARGET_ENV}
</span></span><span style="display:flex;"><span>          - tfenv install &amp;&amp; tgenv install
</span></span><span style="display:flex;"><span>          - terragrunt run-all plan 
</span></span><span style="display:flex;"><span>    - step: &amp;terragrunt-apply
</span></span><span style="display:flex;"><span>        name: terragrunt Apply
</span></span><span style="display:flex;"><span>        trigger: manual
</span></span><span style="display:flex;"><span>        caches:
</span></span><span style="display:flex;"><span>          - terragrunt
</span></span><span style="display:flex;"><span>        script:
</span></span><span style="display:flex;"><span>          - source ${BITBUCKET_CLONE_DIR}/deploy/.env
</span></span><span style="display:flex;"><span>          - apk update &amp;&amp; apk add bash curl groff jq less unzip git
</span></span><span style="display:flex;"><span>          - if [ ! -d ${BITBUCKET_CLONE_DIR}/tool/tfenv ]; then git clone https://github.com/tfutils/tfenv.git ${BITBUCKET_CLONE_DIR}/tool/tfenv; fi
</span></span><span style="display:flex;"><span>          - if [ ! -d ${BITBUCKET_CLONE_DIR}/tool/tgenv ]; then git clone https://github.com/cunymatthieu/tgenv.git ${BITBUCKET_CLONE_DIR}/tool/tgenv; fi
</span></span><span style="display:flex;"><span>          - export PATH=${BITBUCKET_CLONE_DIR}/tool/tfenv/bin:$PATH
</span></span><span style="display:flex;"><span>          - export PATH=${BITBUCKET_CLONE_DIR}/tool/tgenv/bin:$PATH
</span></span><span style="display:flex;"><span>          - cd ${BITBUCKET_CLONE_DIR}/envs/${TARGET_ENV}
</span></span><span style="display:flex;"><span>          - tfenv install &amp;&amp; tgenv install
</span></span><span style="display:flex;"><span>          - terragrunt run-all apply --terragrunt-non-interactive
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pipelines:
</span></span><span style="display:flex;"><span>  default:
</span></span><span style="display:flex;"><span>    - step: *set-production
</span></span><span style="display:flex;"><span>    - step: *terragrunt-plan
</span></span><span style="display:flex;"><span>  branches:
</span></span><span style="display:flex;"><span>    master:
</span></span><span style="display:flex;"><span>      - step: *set-production
</span></span><span style="display:flex;"><span>      - step: *terragrunt-plan
</span></span><span style="display:flex;"><span>      - step:
</span></span><span style="display:flex;"><span>          &lt;&lt;: *terragrunt-apply
</span></span><span style="display:flex;"><span>          deployment: production
</span></span></code></pre></div>
	    
	</div>
    <div>
    	
    </div>
    <ul class="tags">
    
</ul>

  </div>
</section>

    <section><span style="color: #999999;">Nifty <a href="https://codepen.io/wbeeftink/pen/dIaDH">tech tag lists</a> from <a class="pen-owner-link" href="https://codepen.io/wbeeftink">Wouter Beeftink</a> </span>
      
    </section>
  </div>
  
  <script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js" integrity="sha512-0QbL0ph8Tc8g5bLhfVzSqxe9GERORsKhIn1IrpxDAgUsbBGz/V7iSav2zzW325XGd1OMLdL4UiqRJj702IeqnQ==" crossorigin="anonymous"></script>
  
  <script async src="/js/resume.js"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z6BYZ5M6VX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-Z6BYZ5M6VX');
  </script>
  

  
</body>
</html>
